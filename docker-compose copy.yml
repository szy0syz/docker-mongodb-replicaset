version: '3.1'
services:
  mongo-rs0-1:
    image: "start-mongo-rs"
    build: ./mongo-rs0-1
    ports:
      - "37017:27017"
    volumes:
      - ./mongo-rs0-1/data:/data/db
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: 4444
    depends_on:
      - "mongo-rs0-2"
      - "mongo-rs0-3"

  mongo-rs0-2:
    image: "mongo:4.4.4-bionic"
    command: --replSet rs0 --oplogSize 128 --keyFile /usr/src/configs/mongodb.key
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: 4444
    ports:
      - "37018:27017"
    volumes:
      - ./mongo-rs0-2/data:/data/db
      - ./keyFiles:/usr/src/configs

  mongo-rs0-3:
    image: "mongo:4.4.4-bionic"
    command: --replSet rs0 --oplogSize 128 --keyFile /usr/src/configs/mongodb.key
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: 4444
    ports:
      - "37019:27017"
    volumes:
      - ./mongo-rs0-3/data:/data/db
      - ./keyFiles:/usr/src/configs

  setup-rs:
    image: "setup-mongo-rs"
    build: ./setup
    depends_on:
      - "mongo-rs0-1"

  # adminmongo:
  #   image: "mrvautin/adminmongo"
  #   ports:
  #     - "8192:1234"
  #   environment:
  #     - HOST=0.0.0.0
